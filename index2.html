<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Health Prediction - Solution 3 (Complete Hybrid)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --bg1: #f6f8ff;
            --bg2: #eef2ff;
            --bg3: #f7f7fb;

            --glass: rgba(255,255,255,0.55);
            --glass-2: rgba(255,255,255,0.42);
            --stroke: rgba(255,255,255,0.55);

            --text: rgba(17,24,39,0.92);
            --muted: rgba(17,24,39,0.60);

            --shadow: 0 18px 60px rgba(17,24,39,0.12);
            --shadow-2: 0 10px 30px rgba(17,24,39,0.10);

            --blur: 22px;
            --radius: 22px;

            --accent: #4f46e5; 
            --accent2: #60a5fa; 
            --warn: #f59e0b;
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            color: var(--text);
            background: 
                radial-gradient(900px 600px at 15% 10%, rgba(79,70,229,0.12), transparent 55%), 
                radial-gradient(900px 700px at 85% 20%, rgba(96,165,250,0.14), transparent 60%), 
                radial-gradient(1000px 800px at 50% 110%, rgba(245,158,11,0.10), transparent 60%), 
                linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 45%, var(--bg3) 100%);
            min-height: 100vh;
            padding: 22px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .blob {
            position: fixed;
            width: 520px;
            height: 520px;
            border-radius: 50%;
            filter: blur(45px);
            opacity: .55;
            z-index: -1;
            animation: floaty 10s ease-in-out infinite;
        }

            .blob.b1 {
                left: -180px;
                top: -200px;
                background: rgba(79,70,229,0.18)
            }

            .blob.b2 {
                right: -210px;
                top: 120px;
                background: rgba(96,165,250,0.18);
                animation-delay: -3s
            }

            .blob.b3 {
                left: 20%;
                bottom: -260px;
                background: rgba(255,255,255,0.55);
                animation-delay: -6s
            }

        @keyframes floaty {
            0%,100% {
                transform: translate(0,0) scale(1)
            }

            50% {
                transform: translate(30px,-22px) scale(1.05)
            }
        }

        .container {
            width: min(1040px, 100%);
            background: var(--glass);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            -webkit-backdrop-filter:blur(var(--blur));
            backdrop-filter:blur(var(--blur));
        }

        .header {
            background: linear-gradient(135deg, rgba(255,255,255, 0.62) 0%, rgba(255,255,255, 0.42) 100%);
            border-bottom: 1px solid rgba(255,255,255,0.55);
            padding: 34px 26px;
            text-align: center;
            -webkit-backdrop-filter: blur(calc(var(--blur) + 6px));
            backdrop-filter: blur(calc(var(--blur) + 6px));
        }

            .header h1 {
                font-size: 2.15em;
                letter-spacing: .2px;
                margin-bottom: 8px;
                font-weight: 820;
            }

            .header p {
                font-size: 1.03em;
                /*opacity: 0.95;*/
                color: var(--muted);
            }

        .mode-selector {
            display: flex;
            gap: 12px;
            margin-top: 18px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 10px 16px;
            border: 1px solid rgba(255,255,255,0.60);
            border-radius: 999px;
            background: rgba(255,255,255,0.38);
            color: rgba(17,24,39,0.85);
            cursor: pointer;
            font-size: 0.98em;
            font-weight: 720;
            transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, rgba(79,70,229,0.18), rgba(96,165,250,0.18));
            border-color: rgba(79,70,229,.22);
            box-shadow: 0 12px 30px rgba(79,70,229,0.12);
            }

        .mode-btn:hover {
             transform: translateY(-1px);
             box-shadow: var(--shadow-2);
             background: rgba(255,255,255,0.52);
            }

        .content {
            padding: 22px 22px 26px;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }
        .content::-webkit-scrollbar {
            width: 10px
        }

        .content::-webkit-scrollbar-thumb {
            background: rgba(17,24,39,0.14);
            border-radius: 999px;
        }

        .info-box {
            background: rgba(255,255,255,0.42);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 14px 14px;
            color: rgba(17,24,39,.82);
            margin: 12px 0 18px;
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        .form-section {
            margin-bottom: 22px;
        }

        .form-section h2 {
            font-size: 1.35em;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(17,24,39, 0.10);
        }

        h3 {
            color: rgba(79,70,229,0.92);
            font-weight: 820;
            letter-spacing: .2px;
        }


        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 14px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: rgba(17,14,39, 0.78);
            font-weight: 740;
            font-size: 0.92em;
        }

        input, select {
            width: 100%;
            padding: 12px 12px;
            border: 1px solid rgba(255,255,255,0.62);
            border-radius: 16px;
            background: rgba(255,255,255,.40);
            color: rgba(17,24,39,.90);
            outline: none;
            transition: box-shadow .15s ease, transform .15s ease, background .15s ease, border-color .15s ease;
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        input::placeholder{color: rgba(17,24,39,0.35)}

        input:focus, select:focus {
            background: rgba(255,255,255,0.58);
            border-color: rgba(79,70,229,0.28);
            box-shadow: 0 0 0 4px rgba(79,70,229,0.10), 
                        0 12px 30px rgba(79,70,229,0.08);
            transform: translateY(-1px);
        }

        select {
            appearance: none;
            background-image: linear-gradient(45deg, transparent 50%, rgba(17,24,39,0.55) 50%), 
                              linear-gradient(135deg, rgba(17,24,39,0.55) 50%, transparent 50%), 
                              linear-gradient(to right, transparent, transparent);
            background-position: calc(100% - 18px) calc(50% - 3px), calc(100% - 13px) calc(50% - 3px), 0 0;
            background-size: 6px 6px, 6px 6px, 100% 100%;
            background-repeat: no-repeat;
            padding-right: 34px;
        }

        .advanced-section {
            display: none;
            padding: 16px;
            background: rgba(255,255,255,0.34);
            border: 1px dashed rgba(79,70,229,0.30);
            border-radius: 18px;
            margin: 14px 0 0;
        }

        .advanced-section.active {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 26px;
            justify-content: center;
            flex-wrap:wrap;
        }

        button.submit-btn {
            padding: 13px 18px;
            font-size: 1.05em;
            border: 1px solid rgba(255,255,255,0.62);
            border-radius: 18px;
            cursor: pointer;
            font-weight: 780;
            transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
            flex: 1;
            max-width: 420px;
            background: rgba(255,255,255,0.38);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        button.submit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 18px 55px rgba(17,24,39,0.16);
            filter: brightness(1.02);
        }

        button.submit-btn.basic {
            background: linear-gradient(135deg, rgba(79,70,229,0.20), rgba(96,165,250,0.18));
            border-color: rgba(79,70,229,0.22);
        }

        button.submit-btn.advanced {
            background: linear-gradient(135deg, rgba(245,158,11,0.22), rgba(251,191,36,0.18));
            border-color: rgba(245,158,11,0.25);
            display: none;
        }

        button.submit-btn.advanced.active {
            display: block;
        }

        button.submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .results {
            margin-top: 22px;
            display: none;
            border-radius: 18px;
            background: rgba(255,255,255,0.40);
            border: 1px solid rgba(255,255,255,0.62);
            padding: 16px;
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        .results.active {
            display: block;
        }

        .result-card {
            background: rgba(255,255,255,0.45);
            border: 1px solid rgba(255,255,255,0.62);
            border-radius: 18px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .disease-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .risk-meter {
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .risk-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }

        .risk-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .detail-item {
            background: rgba(255,255,255,0.50);
            border: 1px solid rgba(255,255,255,0.62);
            border-radius: 14px;
            padding: 10px;
        }

        .detail-label {
            color: #666;
            font-size: 0.85em;
            font-weight: 600;
        }

        .detail-value {
            color: #333;
            font-size: 1.1em;
            font-weight: 700;
            margin-top: 5px;
        }

        .summary {
            background: rgba(255,255,255,0.45);
            border: 1px solid rgba(59,130,246,0.18);
            border-radius: 18px;
            padding: 14px;
            margin-top: 12px;
            color: rgba(17,24,39,0.85);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 22px;
            margin-top: 16px;
            border-radius: 18px;
            background: rgba(255,255,255,0.40);
            border: 1px solid rgba(255,255,255,0.62);
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(17,24,39,0.10);
            border-top: 4px solid rgba(79,70,229,0.65);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 14px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            display: none;
            margin-top: 14px;
            padding: 14px;
            border-radius: 18px;
            background: rgba(255,255,255,0.40);
            border: 1px solid rgba(239,68,68,0.22);
            color: rgba(127,29,29,0.92);
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        .error.active {
            display: block;
        }

        @media (max-width: 768px) {
            body{padding: 14px}
            .header h1 {
                font-size: 1.8em;
            }

            .mode-selector {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            button.submit-btn {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üêï Dog Health Prediction</h1>
            <p>Solution 3: Complete Hybrid - Choose Your Detail Level</p>
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('basic')">‚ö° Quick Screening (19 fields)</button>
                <button class="mode-btn" onclick="setMode('advanced')">üî¨ Detailed Analysis (67 fields)</button>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Info Box -->
            <div class="info-box">
                <strong>‚ÑπÔ∏è About This Tool:</strong><br>
                Choose between quick screening (19 essential questions) or detailed analysis (comprehensive 67-field evaluation).
                Both are 100% honest - we only use information you provide. No assumptions, no defaults.
            </div>

            <form id="predictionForm">
                <!-- BASIC SECTION -->
                <div class="form-section" id="basicSection">
                    <h2>üìã Core Information (19 Fields)</h2>

                    <div class="form-row">
                        <div><label for="age">Age (years)</label><input type="number" id="age" name="age" step="0.1" required></div>
                        <div><label for="sex">Sex</label><select id="sex" name="sex" required><option value="">-- Select --</option><option>Male</option><option>Female</option></select></div>
                        <div><label for="breed_status">Breed Status</label><select id="breed_status" name="breed_status" required><option value="">-- Select --</option><option>Pure</option><option>Mixed</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="weight_class">Weight Class</label><select id="weight_class" name="weight_class" required><option value="">-- Select --</option><option>Less than 5 kg</option><option>5-9.9 kg</option><option>10-14.9 kg</option><option>15-24.9 kg</option><option>25-34.9 kg</option><option>35 kg or more</option></select></div>
                        <div><label for="life_stage">Life Stage</label><select id="life_stage" name="life_stage" required><option value="">-- Select --</option><option>Puppy (0-1 year)</option><option>Young adult (1-3 years)</option><option>Adult (3-7 years)</option><option>Senior (7+ years)</option></select></div>
                        <div><label for="activity_level">Activity Level</label><select id="activity_level" name="activity_level" required><option value="">-- Select --</option><option>Low</option><option>Moderate</option><option>High</option><option>Very High</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="daily_active_hours">Daily Active Hours</label><input type="number" id="daily_active_hours" name="daily_active_hours" step="0.5" required></div>
                        <div><label for="activity_intensity">Activity Intensity</label><select id="activity_intensity" name="activity_intensity" required><option value="">-- Select --</option><option>Light</option><option>Moderate</option><option>Intense</option></select></div>
                        <div><label for="primary_diet">Primary Diet</label><select id="primary_diet" name="primary_diet" required><option value="">-- Select --</option><option>Commercial kibble</option><option>Commercial wet</option><option>Home cooked</option><option>Raw</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="appetite">Appetite Level</label><select id="appetite" name="appetite" required><option value="">-- Select --</option><option>Poor</option><option>Normal</option><option>Excellent</option></select></div>
                        <div><label for="spayed_neutered">Spayed/Neutered</label><select id="spayed_neutered" name="spayed_neutered" required><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label for="vaccination_status">Vaccination Status</label><select id="vaccination_status" name="vaccination_status" required><option value="">-- Select --</option><option>Current</option><option>Not current</option><option>Unknown</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="fear_loud_noises">Fear of Loud Noises</label><select id="fear_loud_noises" name="fear_loud_noises" required><option value="">-- Select --</option><option>Low</option><option>Moderate</option><option>High</option></select></div>
                        <div><label for="aggression_on_leash">Aggression on Leash</label><select id="aggression_on_leash" name="aggression_on_leash" required><option value="">-- Select --</option><option>None</option><option>Mild</option><option>Moderate</option><option>Severe</option></select></div>
                        <div><label for="home_type">Home Type</label><select id="home_type" name="home_type" required><option value="">-- Select --</option><option>House</option><option>Apartment</option><option>Condo</option><option>Other</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="home_area">Home Area</label><select id="home_area" name="home_area" required><option value="">-- Select --</option><option>Urban</option><option>Suburban</option><option>Rural</option></select></div>
                        <div><label for="lead_present">Lead Present</label><select id="lead_present" name="lead_present" required><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                        <div><label for="annual_income">Annual Income</label><select id="annual_income" name="annual_income" required><option value="">-- Select --</option><option>Less than $25,000</option><option>$25,000-$49,999</option><option>$50,000-$99,999</option><option>$100,000-$249,999</option><option>$250,000 or more</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="population_density">Population Density</label><select id="population_density" name="population_density" required><option value="">-- Select --</option><option>Urban</option><option>Suburban</option><option>Rural</option></select></div>
                    </div>
                </div>

                <!-- ADVANCED SECTION -->
                <div class="form-section advanced-section" id="advancedSection">
                    <h2>üî¨ Advanced Fields (48 Additional)</h2>
                    <p style="margin-bottom: 20px; color: #666;">Fill in as many as you know. Leave blank if unsure.</p>

                    <!-- Activity Details -->
                    <h3 style="margin-top: 20px; color: #667eea;">Physical Activity Details</h3>
                    <div class="form-row">
                        <div><label>Moderate Weather Hours/Day</label><input type="number" id="pa_moderate_weather_daily_hours_outside" step="0.5"></div>
                        <div><label>Hot Weather Months/Year</label><input type="number" id="pa_hot_weather_months_per_year" step="0.1"></div>
                        <div><label>Cold Weather Months/Year</label><input type="number" id="pa_cold_weather_months_per_year" step="0.1"></div>
                    </div>

                    <!-- Diet Details -->
                    <h3 style="margin-top: 20px; color: #667eea;">Diet Details</h3>
                    <div class="form-row">
                        <div><label>Diet Consistency</label><select id="df_diet_consistency"><option value="">-- Select --</option><option>Consistent</option><option>Variable</option><option>Unknown</option></select></div>
                        <div><label>Appetite Change Last Year</label><select id="df_appetite_change_last_year"><option value="">-- Select --</option><option>No</option><option>Yes</option><option>Unknown</option></select></div>
                        <div><label>Ever Overweight</label><select id="df_ever_overweight"><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label>Daily Supplements</label><select id="df_daily_supplements"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label>Glucosamine Supplements</label><select id="df_daily_supplements_glucosamine"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label>Omega-3 Supplements</label><select id="df_daily_supplements_omega3"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                    </div>

                    <!-- Behavior Details -->
                    <h3 style="margin-top: 20px; color: #667eea;">Behavior Details</h3>
                    <div class="form-row">
                        <div><label>Fear of Unknown Situations</label><select id="db_fear_level_unknown_situations"><option value="">-- Select --</option><option>Low</option><option>Moderate</option><option>High</option><option>Unknown</option></select></div>
                        <div><label>Barking When Alone</label><select id="db_left_alone_barking_frequency"><option value="">-- Select --</option><option>Never</option><option>Rarely</option><option>Often</option><option>Unknown</option></select></div>
                        <div><label>Attention Seeking</label><select id="db_attention_seeking_follows_humans_frequency"><option value="">-- Select --</option><option>Rarely</option><option>Sometimes</option><option>Often</option><option>Unknown</option></select></div>
                    </div>

                    <!-- Medical Care -->
                    <h3 style="margin-top: 20px; color: #667eea;">Medical Care</h3>
                    <div class="form-row">
                        <div><label>Dental Brushing</label><select id="mp_dental_brushing_frequency"><option value="">-- Select --</option><option>Never</option><option>Rarely</option><option>Sometimes</option><option>Daily</option></select></div>
                        <div><label>Flea/Tick Treatment</label><select id="mp_flea_and_tick_treatment"><option value="">-- Select --</option><option>Never</option><option>Annually</option><option>Monthly</option><option>Unknown</option></select></div>
                        <div><label>Heartworm Prevention</label><select id="mp_heartworm_preventative"><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                    </div>

                    <!-- Environment -->
                    <h3 style="margin-top: 20px; color: #667eea;">Home Environment</h3>
                    <div class="form-row">
                        <div><label>Sleep Hours (Night)</label><input type="number" id="de_nighttime_sleep_avg_hours" step="0.5" min="0" max="24"></div>
                        <div><label>Sleep Hours (Day)</label><input type="number" id="de_daytime_sleep_avg_hours" step="0.5" min="0" max="24"></div>
                        <div><label>Drinking Water Source</label><select id="de_drinking_water_source"><option value="">-- Select --</option><option>Tap</option><option>Filtered</option><option>Bottled</option><option>Well</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label>Lead Paint Present</label><select id="de_radon_present"><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                        <div><label>Air Conditioning</label><select id="de_central_air_conditioning_present"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label>Stairs in Home</label><select id="de_stairs_in_home"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                    </div>

                    <!-- Household -->
                    <h3 style="margin-top: 20px; color: #667eea;">Household</h3>
                    <div class="form-row">
                        <div><label>Number of People</label><input type="number" id="oc_household_person_count" step="1" min="1"></div>
                        <div><label>Number of Children</label><input type="number" id="oc_household_child_count" step="1" min="0"></div>
                        <div><label>Other Dogs</label><input type="number" id="de_other_present_animals_dogs" step="1" min="0"></div>
                    </div>
                </div>

                <!-- BUTTONS -->
                <div class="button-group">
                    <button type="submit" class="submit-btn basic" id="basicSubmit">
                        ‚ö° Get Quick Prediction
                    </button>
                    <button type="submit" class="submit-btn advanced" id="advancedSubmit">
                        üî¨ Get Detailed Analysis
                    </button>
                </div>
            </form>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing your dog's health profile...</p>
            </div>

            <!-- Error -->
            <div class="error" id="error"></div>

            <!-- Results -->
            <div class="results" id="results">
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'basic';

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('advancedSection').classList.toggle('active', mode === 'advanced');
            document.getElementById('basicSubmit').style.display = mode === 'basic' ? 'block' : 'none';
            document.getElementById('advancedSubmit').style.display = mode === 'advanced' ? 'block' : 'none';
        }

        function getRiskColor(score) {
            if (score < 20) return '#10b981';
            if (score < 40) return '#6366f1';
            if (score < 60) return '#f59e0b';
            if (score < 80) return '#f97316';
            return '#ef4444';
        }

        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const results = document.getElementById('results');

            loading.classList.add('active');
            error.classList.remove('active');
            results.classList.remove('active');

            try {
                const formData = new FormData(document.getElementById('predictionForm'));
                const data = Object.fromEntries(formData);

                // Convert numeric fields
                ['age', 'daily_active_hours', 'pa_moderate_weather_daily_hours_outside', 'pa_hot_weather_months_per_year',
                    'pa_cold_weather_months_per_year', 'de_nighttime_sleep_avg_hours', 'de_daytime_sleep_avg_hours',
                    'oc_household_person_count', 'oc_household_child_count', 'de_other_present_animals_dogs'].forEach(field => {
                        if (data[field]) data[field] = parseFloat(data[field]);
                    });

                const endpoint = currentMode === 'basic'
                    ? 'http://127.0.0.1:8000/predict-basic'
                    : 'http://127.0.0.1:8000/predict-advanced';

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error('API error. Make sure server is running on http://127.0.0.1:8000');
                }

                const prediction = await response.json();

                let html = `
                            <h2>üìä Prediction Results</h2>
                            <div class="info-box">
                                <strong>Model:</strong> ${prediction.model_type}<br>
                                <strong>Transparency:</strong> ${prediction.honesty_level}<br>
                                <strong>Average Risk:</strong> ${prediction.average_risk.toFixed(1)}%
                            </div>
                        `;

                prediction.predictions.forEach(pred => {
                    const color = getRiskColor(pred.risk_score);
                    const width = Math.min(100, pred.risk_score);

                    // Reliability color and badge
                    let reliabilityColor = '#10b981';
                    let reliabilityBgColor = '#d1fae5';
                    if (pred.reliability === 'Good') {
                        reliabilityColor = '#0284c7';
                        reliabilityBgColor = '#e0f2fe';
                    } else if (pred.reliability === 'Moderate') {
                        reliabilityColor = '#f59e0b';
                        reliabilityBgColor = '#fef3c7';
                    } else if (pred.reliability === 'Low') {
                        reliabilityColor = '#ef4444';
                        reliabilityBgColor = '#fee2e2';
                    }

                    html += `
                                <div class="result-card">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div class="disease-name">${pred.disease}</div>
                                        <div style="background: ${reliabilityBgColor}; color: ${reliabilityColor}; padding: 6px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 600; border: 1px solid ${reliabilityColor};">
                                            ‚≠ê Reliability: ${pred.reliability}
                                        </div>
                                    </div>
                                    <div class="risk-meter">
                                        <div class="risk-fill" style="width: ${width}%; background: ${color};">
                                            ${pred.risk_score.toFixed(1)}%
                                        </div>
                                    </div>
                                    <div class="risk-details">
                                        <div class="detail-item">
                                            <div class="detail-label">Risk Level</div>
                                            <div class="detail-value">${pred.interpretation}</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Confidence</div>
                                            <div class="detail-value">${pred.confidence.toFixed(1)}%</div>
                                        </div>
                                        <div class="detail-item">
                                            <div class="detail-label">Model AUC</div>
                                            <div class="detail-value">${pred.auc_score.toFixed(4)}</div>
                                        </div>
                                        <div class="detail-item" style="grid-column: 1/-1;">
                                            <div class="detail-label">Why This Reliability?</div>
                                            <div class="detail-value" style="font-size: 0.95em; line-height: 1.4;">${pred.reliability_explanation}</div>
                                        </div>
                                        <div class="detail-item" style="grid-column: 1/-1;">
                                            <div class="detail-label">Recommendation</div>
                                            <div class="detail-value" style="font-size: 0.95em;">${pred.recommendation}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                });

                html += `<div class="summary"><strong>üìã Summary:</strong> ${prediction.summary}<br><em style="font-size: 0.9em; margin-top: 10px; display: block;">Note: ${prediction.reliability_note}</em></div>`;

                document.getElementById('resultsContent').innerHTML = html;
                results.classList.add('active');

            } catch (err) {
                console.error('Full error:', err);
                let errorMsg = err.message;

                // Better error messages
                if (err.message.includes('Failed to fetch')) {
                    errorMsg = 'Cannot connect to API server. Make sure it\'s running on http://127.0.0.1:8000';
                } else if (err.message.includes('API error')) {
                    errorMsg = 'API Server not responding. Please restart it.';
                }

                error.textContent = '‚ùå Error: ' + errorMsg;
                error.classList.add('active');
            } finally {
                loading.classList.remove('active');
            }
        });
    </script>
</body>
</html>
