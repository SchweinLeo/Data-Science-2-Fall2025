<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Health Prediction - Solution 3 (Complete Hybrid)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .mode-selector {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .mode-btn {
            padding: 12px 30px;
            border: 2px solid white;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: 25px;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 600;
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .content {
            padding: 40px 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 0.95em;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.95em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .advanced-section {
            display: none;
            padding: 20px;
            background: #f0f4ff;
            border: 2px dashed #667eea;
            border-radius: 10px;
            margin: 20px 0;
        }

        .advanced-section.active {
            display: block;
        }

        .info-box {
            background: #e0e7ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #3730a3;
            font-size: 0.95em;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            justify-content: center;
        }

        button.submit-btn {
            padding: 14px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            max-width: 400px;
        }

        button.submit-btn.basic {
            background: #667eea;
            color: white;
        }

        button.submit-btn.advanced {
            background: #f59e0b;
            color: white;
            display: none;
        }

        button.submit-btn.advanced.active {
            display: block;
        }

        button.submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .results {
            margin-top: 40px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        .disease-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .risk-meter {
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .risk-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
        }

        .risk-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .detail-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
        }

        .detail-label {
            color: #666;
            font-size: 0.85em;
            font-weight: 600;
        }

        .detail-value {
            color: #333;
            font-size: 1.1em;
            font-weight: 700;
            margin-top: 5px;
        }

        .summary {
            background: #dbeafe;
            border-left: 5px solid #3b82f6;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            color: #1e40af;
            font-size: 1.05em;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee2e2;
            border-left: 5px solid #dc2626;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .error.active {
            display: block;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .mode-selector {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            button.submit-btn {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üêï Dog Health Prediction</h1>
            <p>Solution 3: Complete Hybrid - Choose Your Detail Level</p>
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('basic')">‚ö° Quick Screening (19 fields)</button>
                <button class="mode-btn" onclick="setMode('advanced')">üî¨ Detailed Analysis (67 fields)</button>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Info Box -->
            <div class="info-box">
                <strong>‚ÑπÔ∏è About This Tool:</strong><br>
                Choose between quick screening (19 essential questions) or detailed analysis (comprehensive 67-field evaluation).
                Both are 100% honest - we only use information you provide. No assumptions, no defaults.
            </div>

            <form id="predictionForm">
                <!-- BASIC SECTION -->
                <div class="form-section" id="basicSection">
                    <h2>üìã Core Information (19 Fields)</h2>

                    <div class="form-row">
                        <div><label for="age">Age (years)</label><input type="number" id="age" name="age" step="0.1" required></div>
                        <div><label for="sex">Sex</label><select id="sex" name="sex" required><option value="">-- Select --</option><option>Male</option><option>Female</option></select></div>
                        <div><label for="breed_status">Breed Status</label><select id="breed_status" name="breed_status" required><option value="">-- Select --</option><option>Pure</option><option>Mixed</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="weight_class">Weight Class</label><select id="weight_class" name="weight_class" required><option value="">-- Select --</option><option>Less than 5 kg</option><option>5-9.9 kg</option><option>10-14.9 kg</option><option>15-24.9 kg</option><option>25-34.9 kg</option><option>35 kg or more</option></select></div>
                        <div><label for="life_stage">Life Stage</label><select id="life_stage" name="life_stage" required><option value="">-- Select --</option><option>Puppy (0-1 year)</option><option>Young adult (1-3 years)</option><option>Adult (3-7 years)</option><option>Senior (7+ years)</option></select></div>
                        <div><label for="activity_level">Activity Level</label><select id="activity_level" name="activity_level" required><option value="">-- Select --</option><option>Low</option><option>Moderate</option><option>High</option><option>Very High</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="daily_active_hours">Daily Active Hours</label><input type="number" id="daily_active_hours" name="daily_active_hours" step="0.5" required></div>
                        <div><label for="activity_intensity">Activity Intensity</label><select id="activity_intensity" name="activity_intensity" required><option value="">-- Select --</option><option>Light</option><option>Moderate</option><option>Intense</option></select></div>
                        <div><label for="primary_diet">Primary Diet</label><select id="primary_diet" name="primary_diet" required><option value="">-- Select --</option><option>Commercial kibble</option><option>Commercial wet</option><option>Home cooked</option><option>Raw</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="appetite">Appetite Level</label><select id="appetite" name="appetite" required><option value="">-- Select --</option><option>Poor</option><option>Normal</option><option>Excellent</option></select></div>
                        <div><label for="spayed_neutered">Spayed/Neutered</label><select id="spayed_neutered" name="spayed_neutered" required><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label for="vaccination_status">Vaccination Status</label><select id="vaccination_status" name="vaccination_status" required><option value="">-- Select --</option><option>Current</option><option>Not current</option><option>Unknown</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="fear_loud_noises">Fear of Loud Noises</label><select id="fear_loud_noises" name="fear_loud_noises" required><option value="">-- Select --</option><option>Low</option><option>Moderate</option><option>High</option></select></div>
                        <div><label for="aggression_on_leash">Aggression on Leash</label><select id="aggression_on_leash" name="aggression_on_leash" required><option value="">-- Select --</option><option>None</option><option>Mild</option><option>Moderate</option><option>Severe</option></select></div>
                        <div><label for="home_type">Home Type</label><select id="home_type" name="home_type" required><option value="">-- Select --</option><option>House</option><option>Apartment</option><option>Condo</option><option>Other</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="home_area">Home Area</label><select id="home_area" name="home_area" required><option value="">-- Select --</option><option>Urban</option><option>Suburban</option><option>Rural</option></select></div>
                        <div><label for="lead_present">Lead Present</label><select id="lead_present" name="lead_present" required><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                        <div><label for="annual_income">Annual Income</label><select id="annual_income" name="annual_income" required><option value="">-- Select --</option><option>Less than $25,000</option><option>$25,000-$49,999</option><option>$50,000-$99,999</option><option>$100,000-$249,999</option><option>$250,000 or more</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label for="population_density">Population Density</label><select id="population_density" name="population_density" required><option value="">-- Select --</option><option>Urban</option><option>Suburban</option><option>Rural</option></select></div>
                    </div>
                </div>

                <!-- ADVANCED SECTION -->
                <div class="form-section advanced-section" id="advancedSection">
                    <h2>üî¨ Advanced Fields (48 Additional)</h2>
                    <p style="margin-bottom: 20px; color: #666;">Fill in as many as you know. Leave blank if unsure.</p>
                    
                    <!-- Activity Details -->
                    <h3 style="margin-top: 20px; color: #667eea;">Physical Activity Details</h3>
                    <div class="form-row">
                        <div><label>Moderate Weather Hours/Day</label><input type="number" id="pa_moderate_weather_daily_hours_outside" step="0.5"></div>
                        <div><label>Hot Weather Months/Year</label><input type="number" id="pa_hot_weather_months_per_year" step="0.1"></div>
                        <div><label>Cold Weather Months/Year</label><input type="number" id="pa_cold_weather_months_per_year" step="0.1"></div>
                    </div>

                    <!-- Diet Details -->
                    <h3 style="margin-top: 20px; color: #667eea;">Diet Details</h3>
                    <div class="form-row">
                        <div><label>Diet Consistency</label><select id="df_diet_consistency"><option value="">-- Select --</option><option>Consistent</option><option>Variable</option><option>Unknown</option></select></div>
                        <div><label>Appetite Change Last Year</label><select id="df_appetite_change_last_year"><option value="">-- Select --</option><option>No</option><option>Yes</option><option>Unknown</option></select></div>
                        <div><label>Ever Overweight</label><select id="df_ever_overweight"><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label>Daily Supplements</label><select id="df_daily_supplements"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label>Glucosamine Supplements</label><select id="df_daily_supplements_glucosamine"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label>Omega-3 Supplements</label><select id="df_daily_supplements_omega3"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                    </div>

                    <!-- Behavior Details -->
                    <h3 style="margin-top: 20px; color: #667eea;">Behavior Details</h3>
                    <div class="form-row">
                        <div><label>Fear of Unknown Situations</label><select id="db_fear_level_unknown_situations"><option value="">-- Select --</option><option>Low</option><option>Moderate</option><option>High</option><option>Unknown</option></select></div>
                        <div><label>Barking When Alone</label><select id="db_left_alone_barking_frequency"><option value="">-- Select --</option><option>Never</option><option>Rarely</option><option>Often</option><option>Unknown</option></select></div>
                        <div><label>Attention Seeking</label><select id="db_attention_seeking_follows_humans_frequency"><option value="">-- Select --</option><option>Rarely</option><option>Sometimes</option><option>Often</option><option>Unknown</option></select></div>
                    </div>

                    <!-- Medical Care -->
                    <h3 style="margin-top: 20px; color: #667eea;">Medical Care</h3>
                    <div class="form-row">
                        <div><label>Dental Brushing</label><select id="mp_dental_brushing_frequency"><option value="">-- Select --</option><option>Never</option><option>Rarely</option><option>Sometimes</option><option>Daily</option></select></div>
                        <div><label>Flea/Tick Treatment</label><select id="mp_flea_and_tick_treatment"><option value="">-- Select --</option><option>Never</option><option>Annually</option><option>Monthly</option><option>Unknown</option></select></div>
                        <div><label>Heartworm Prevention</label><select id="mp_heartworm_preventative"><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                    </div>

                    <!-- Environment -->
                    <h3 style="margin-top: 20px; color: #667eea;">Home Environment</h3>
                    <div class="form-row">
                        <div><label>Sleep Hours (Night)</label><input type="number" id="de_nighttime_sleep_avg_hours" step="0.5" min="0" max="24"></div>
                        <div><label>Sleep Hours (Day)</label><input type="number" id="de_daytime_sleep_avg_hours" step="0.5" min="0" max="24"></div>
                        <div><label>Drinking Water Source</label><select id="de_drinking_water_source"><option value="">-- Select --</option><option>Tap</option><option>Filtered</option><option>Bottled</option><option>Well</option></select></div>
                    </div>

                    <div class="form-row">
                        <div><label>Lead Paint Present</label><select id="de_radon_present"><option value="">-- Select --</option><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                        <div><label>Air Conditioning</label><select id="de_central_air_conditioning_present"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                        <div><label>Stairs in Home</label><select id="de_stairs_in_home"><option value="">-- Select --</option><option>Yes</option><option>No</option></select></div>
                    </div>

                    <!-- Household -->
                    <h3 style="margin-top: 20px; color: #667eea;">Household</h3>
                    <div class="form-row">
                        <div><label>Number of People</label><input type="number" id="oc_household_person_count" step="1" min="1"></div>
                        <div><label>Number of Children</label><input type="number" id="oc_household_child_count" step="1" min="0"></div>
                        <div><label>Other Dogs</label><input type="number" id="de_other_present_animals_dogs" step="1" min="0"></div>
                    </div>
                </div>

                <!-- BUTTONS -->
                <div class="button-group">
                    <button type="submit" class="submit-btn basic" id="basicSubmit">
                        ‚ö° Get Quick Prediction
                    </button>
                    <button type="submit" class="submit-btn advanced" id="advancedSubmit">
                        üî¨ Get Detailed Analysis
                    </button>
                </div>
            </form>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing your dog's health profile...</p>
            </div>

            <!-- Error -->
            <div class="error" id="error"></div>

            <!-- Results -->
            <div class="results" id="results">
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'basic';

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('advancedSection').classList.toggle('active', mode === 'advanced');
            document.getElementById('basicSubmit').style.display = mode === 'basic' ? 'block' : 'none';
            document.getElementById('advancedSubmit').style.display = mode === 'advanced' ? 'block' : 'none';
        }

        function getRiskColor(score) {
            if (score < 20) return '#10b981';
            if (score < 40) return '#6366f1';
            if (score < 60) return '#f59e0b';
            if (score < 80) return '#f97316';
            return '#ef4444';
        }

        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const results = document.getElementById('results');

            loading.classList.add('active');
            error.classList.remove('active');
            results.classList.remove('active');

            try {
                const formData = new FormData(document.getElementById('predictionForm'));
                const data = Object.fromEntries(formData);

                // Convert numeric fields
                ['age', 'daily_active_hours', 'pa_moderate_weather_daily_hours_outside', 'pa_hot_weather_months_per_year', 
                 'pa_cold_weather_months_per_year', 'de_nighttime_sleep_avg_hours', 'de_daytime_sleep_avg_hours',
                 'oc_household_person_count', 'oc_household_child_count', 'de_other_present_animals_dogs'].forEach(field => {
                    if (data[field]) data[field] = parseFloat(data[field]);
                });

                const endpoint = currentMode === 'basic' 
                    ? 'http://127.0.0.1:8000/predict-basic'
                    : 'http://127.0.0.1:8000/predict-advanced';

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error('API error. Make sure server is running on http://127.0.0.1:8000');
                }

                const prediction = await response.json();

                let html = `
                    <h2>üìä Prediction Results</h2>
                    <div class="info-box">
                        <strong>Model:</strong> ${prediction.model_type}<br>
                        <strong>Transparency:</strong> ${prediction.honesty_level}<br>
                        <strong>Average Risk:</strong> ${prediction.average_risk.toFixed(1)}%
                    </div>
                `;

                prediction.predictions.forEach(pred => {
                    const color = getRiskColor(pred.risk_score);
                    const width = Math.min(100, pred.risk_score);
                    
                    // Reliability color and badge
                    let reliabilityColor = '#10b981';
                    let reliabilityBgColor = '#d1fae5';
                    if (pred.reliability === 'Good') {
                        reliabilityColor = '#0284c7';
                        reliabilityBgColor = '#e0f2fe';
                    } else if (pred.reliability === 'Moderate') {
                        reliabilityColor = '#f59e0b';
                        reliabilityBgColor = '#fef3c7';
                    } else if (pred.reliability === 'Low') {
                        reliabilityColor = '#ef4444';
                        reliabilityBgColor = '#fee2e2';
                    }

                    html += `
                        <div class="result-card">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div class="disease-name">${pred.disease}</div>
                                <div style="background: ${reliabilityBgColor}; color: ${reliabilityColor}; padding: 6px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 600; border: 1px solid ${reliabilityColor};">
                                    ‚≠ê Reliability: ${pred.reliability}
                                </div>
                            </div>
                            <div class="risk-meter">
                                <div class="risk-fill" style="width: ${width}%; background: ${color};">
                                    ${pred.risk_score.toFixed(1)}%
                                </div>
                            </div>
                            <div class="risk-details">
                                <div class="detail-item">
                                    <div class="detail-label">Risk Level</div>
                                    <div class="detail-value">${pred.interpretation}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Confidence</div>
                                    <div class="detail-value">${pred.confidence.toFixed(1)}%</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Model AUC</div>
                                    <div class="detail-value">${pred.auc_score.toFixed(4)}</div>
                                </div>
                                <div class="detail-item" style="grid-column: 1/-1;">
                                    <div class="detail-label">Why This Reliability?</div>
                                    <div class="detail-value" style="font-size: 0.95em; line-height: 1.4;">${pred.reliability_explanation}</div>
                                </div>
                                <div class="detail-item" style="grid-column: 1/-1;">
                                    <div class="detail-label">Recommendation</div>
                                    <div class="detail-value" style="font-size: 0.95em;">${pred.recommendation}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `<div class="summary"><strong>üìã Summary:</strong> ${prediction.summary}<br><em style="font-size: 0.9em; margin-top: 10px; display: block;">Note: ${prediction.reliability_note}</em></div>`;

                document.getElementById('resultsContent').innerHTML = html;
                results.classList.add('active');

            } catch (err) {
                console.error('Full error:', err);
                let errorMsg = err.message;
                
                // Better error messages
                if (err.message.includes('Failed to fetch')) {
                    errorMsg = 'Cannot connect to API server. Make sure it\'s running on http://127.0.0.1:8000';
                } else if (err.message.includes('API error')) {
                    errorMsg = 'API Server not responding. Please restart it.';
                }
                
                error.textContent = '‚ùå Error: ' + errorMsg;
                error.classList.add('active');
            } finally {
                loading.classList.remove('active');
            }
        });
    </script>
</body>
</html>
